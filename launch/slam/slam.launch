<?xml version="1.0"?>
<launch>
    <arg name="robot_name"            default="$(env ROBOT_NAME)" />
    <arg name="base_frame"            default="base_link" />
    <arg name="output"                default="screen" />
    <arg name="slam_method"           default="hector" doc="slam methods: gmapping, cartographer, hector">

    <group ns="$(arg robot_name)">

        <include file="$(find camel_robot)/launch/slam/ekf_localization.launch">
            <arg name="robot_name"            value="$(env ROBOT_NAME)" />
            <arg name="base_frame"            value="$(arg base_frame)" />
            <arg name="output"                value="$(arg output)" />
        </include>


        <include file="$(find camel_robot)/launch/slam/$(arg slam_method)_slam.launch">
            <arg name="robot_name"            value="$(env ROBOT_NAME)" />
            <arg name="base_frame"            value="$(arg base_frame)" />
            <arg name="output"                value="$(arg output)" />
        </include>


        
        <!-- <node pkg="robot_localization" type="ekf_localization_node" name="ekf_se" clear_params="true" output="$(arg output)">
            <rosparam command="load" file="$(find camel_robot)/params/slam/ekf_localization_config.yaml" />

            <param name="map_frame" value="$(arg robot_name)/map"/>
            <param name="odom_frame" value="$(arg robot_name)/odom"/>
            <param name="base_link_frame" value="$(arg robot_name)/$(arg base_frame)"/>
            <param name="world_frame" value="$(arg robot_name)/odom"/>

            <param name="odom0" value="/$(arg robot_name)/roboteq/odom"/> 
            <param name="odom0_queue_size" value="2"/>
            <param name="odom0_pose_rejection_threshold" value="5"/>
            <param name="odom0_twist_rejection_threshold" value="2"/>

            <param name="imu0" value="/$(arg robot_name)/imu/data"/> 
            <param name="imu0_queue_size" value="5"/>
            <param name="imu0_pose_rejection_threshold" value="0.8"/>
            <param name="imu0_twist_rejection_threshold" value="0.8 "/>
            <param name="imu0_linear_acceleration_rejection_threshold" value="0.8 "/>
            <param name="imu0_remove_gravitational_acceleration" value="true"/>

        
            <remap from="/$(arg robot_name)/odometry/filtered" to="/$(arg robot_name)/odometry"/>
            <remap from="/$(arg robot_name)/accel/filtered" to="/$(arg robot_name)/accel"/>

        </node>

        <group if="$(eval slam_method == 'hector_slam')">
            <node pkg="hector_mapping" type="hector_mapping" name="hector_mapping" output="$(arg output)">
    
                <param name="map_frame" value="$(arg robot_name)/map"/>
                <param name="odom_frame" value="$(arg robot_name)/odom"/>
                <param name="base_frame" value="$(arg robot_name)/$(arg base_frame)"/>
                
                <param name="use_tf_scan_transformation" value="true"/>
                <param name="use_tf_pose_start_estimate" value="false"/>
                <param name="pub_map_odom_transform" value="true"/>
                
                <param name="map_resolution" value="0.050"/>
                <param name="map_size" value="2048"/>
                <param name="map_start_x" value="0.5"/>
                <param name="map_start_y" value="0.5" />
                <param name="map_multi_res_levels" value="2" />

                <param name="update_factor_free" value="0.4"/>
                <param name="update_factor_occupied" value="0.9" />    
                <param name="map_update_distance_thresh" value="0.4"/>
                <param name="map_update_angle_thresh" value="0.06" />
                <param name="laser_z_min_value" value = "-1.0" />
                <param name="laser_z_max_value" value = "1.0" />
                
                <param name="advertise_map_service" value="true"/>
                
                <param name="scan_subscriber_queue_size" value="5"/>
                <param name="scan_topic" value="/$(arg robot_name)/scan"/>
                <param name="tf_map_scanmatch_transform_frame_name" value="$(arg robot_name)/scanmatcher_frame" />
            </node>
        </group>


        <group if="$(eval slam_method == 'gmapping')">
            <node pkg="gmapping" type="slam_gmapping" name="slam_gmapping" output="$(arg output)"> 
                <param name="base_frame" value="$(arg robot_name)/$(arg base_frame)"/> 
                <param name="odom_frame" value="$(arg robot_name)/odom"/> 
                <param name="map_frame" value="$(arg robot_name)/map"/>

                <param name="map_update_interval" value="5.0"/> 
                <param name="maxUrange" value="6.0"/> 
                <param name="maxRange" value="8.0"/> 
                <param name="sigma" value="0.05"/> 
                <param name="kernelSize" value="1"/> 
                <param name="lstep" value="0.05"/> 
                <param name="astep" value="0.05"/> 
                <param name="iterations" value="5"/> 
                <param name="lsigma" value="0.075"/> 
                <param name="ogain" value="3.0"/> 
                <param name="lskip" value="0"/> 
                <param name="minimumScore" value="100"/> 
                <param name="srr" value="0.01"/> 
                <param name="srt" value="0.02"/> 
                <param name="str" value="0.01"/> 
                <param name="stt" value="0.02"/> 
                <param name="linearUpdate" value="0.5"/> 
                <param name="angularUpdate" value="0.436"/> 
                <param name="temporalUpdate" value="-1.0"/> 
                <param name="resampleThreshold" value="0.5"/> 
                <param name="particles" value="80"/> 
            
                <param name="xmin" value="-1.0"/> 
                <param name="ymin" value="-1.0"/> 
                <param name="xmax" value="1.0"/> 
                <param name="ymax" value="1.0"/> 
            
                <param name="delta" value="0.05"/> 
                <param name="llsamplerange" value="0.01"/> 
                <param name="llsamplestep" value="0.01"/> 
                <param name="lasamplerange" value="0.005"/> 
                <param name="lasamplestep" value="0.005"/> 
            </node> 
        </group>

        <group if="$(eval slam_method == 'cartographer')">
        </group> -->

    </group>
</launch>